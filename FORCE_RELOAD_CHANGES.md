# Изменения для принудительной загрузки данных при перезагрузке

## Обзор изменений

Была переделана система первоначальной настройки приложения для принудительной загрузки всех данных при перезагрузке страницы, включая очистку кеша браузера и принудительную перезагрузку изображений.

## Основные изменения

### 1. Новый провайдер ForceReloadProvider

**Файл:** `src/app/_providers/force-reload-provider.tsx`

- Создан новый провайдер, который запускается при перезагрузке страницы
- Выполняет принудительную очистку кеша браузера
- Загружает все данные с cache-busting параметрами
- Предзагружает все изображения с принудительным обновлением
- Прогревает все страницы приложения

### 2. Утилиты для работы с кешем

**Файл:** `src/3_shared/lib/cache-utils.ts`

- `addCacheBuster()` - добавляет timestamp параметры к URL
- `clearBrowserCache()` - очищает кеш браузера, localStorage, sessionStorage
- `preloadImages()` - принудительно предзагружает изображения
- `createForceReloadFetch()` - создает fetch запросы с отключенным кешированием
- `isPageReload()` - определяет, является ли навигация перезагрузкой

### 3. Обновленные страницы

**Файлы:**

- `src/app/catalogue/page.tsx`
- `src/app/catalogue/[id]/page.tsx`

Изменения:

- Отключено статическое кеширование (`dynamic = "force-dynamic"`)
- Добавлены cache-busting параметры ко всем fetch запросам
- Добавлены заголовки для отключения кеширования

### 4. Обновленный QueryProvider

**Файл:** `src/app/_providers/query-provider.tsx`

- Отключено кеширование React Query
- Включено принудительное обновление при фокусе, монтировании и переподключении

### 5. Обновленный InitialWalkthroughProvider

**Файл:** `src/app/_providers/initial-walkthrough-provider.tsx`

- Добавлены cache-busting параметры к запросам категорий

### 6. Обновленный Layout

**Файл:** `src/app/layout.tsx`

- Интегрирован новый ForceReloadProvider в цепочку провайдеров

## Как это работает

1. **При перезагрузке страницы** ForceReloadProvider определяет это через Performance API
2. **Очистка кеша** - очищается кеш браузера, localStorage, sessionStorage
3. **Загрузка данных** - все API запросы выполняются с принудительным обновлением
4. **Предзагрузка изображений** - все изображения загружаются заново с cache-busting
5. **Прогрев страниц** - все страницы приложения посещаются для загрузки данных

## Результат

Теперь при каждой перезагрузке страницы:

- ✅ Очищается весь кеш браузера
- ✅ Принудительно загружаются все данные с сервера
- ✅ Перезагружаются все изображения
- ✅ Прогреваются все страницы приложения
- ✅ Не используется никакой кешированный контент

## Порядок выполнения

1. Очистка кеша браузера
2. Загрузка категорий
3. Загрузка продуктов
4. Сбор изображений для предзагрузки
5. Предзагрузка изображений
6. Прогрев страниц

Каждый шаг отображается в модальном окне с прогресс-баром.
